import streamlit_authenticator as stauth
import yaml
from yaml import SafeLoader
from PIL import Image
import streamlit as st
import os



#if 'authentication_status' not in st.session_state:
#    st.session_state.authentication_status = None


#hashed_passwords = stauth.Hasher(['password']).generate()
#hashed_passwords





def check():
    path = os.path.abspath(os.path.join(os.path.dirname( __file__ ), '', 'config.yaml' ))
    with open(path) as file:
    #st.write(file.read())

        config = yaml.load(file, Loader=SafeLoader)

    authenticator = stauth.Authenticate(
        config['credentials'],
        config['cookie']['name'],
        config['cookie']['key'],
        config['cookie']['expiry_days'],
        config['preauthorized']
    )

    with st.sidebar:
        st.header("RedJammer Utilities")
        st.markdown("""<svg height="100" width="100" id="RedJammer Utilities" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 249.55 254.46"><defs><style>.b{fill:#ff0500;}</style></defs><path class="b" d="m20.61,155.63c3.74-2.65,7.42-5.41,11.24-7.94,15.35-10.19,30.75-20.32,46.14-30.45.77-.51,1.66-.83,2.5-1.24-9.75,13.64-19.26,27.42-25.95,42.92.72-.23,1.22-.62,1.65-1.07,6.51-6.94,12.98-13.91,19.52-20.81,3.27-3.45,6.65-6.78,9.99-10.16-.49,1.69-.95,3.39-1.48,5.06-3,9.44-6.13,18.84-8.99,28.33-1.09,3.6-1.56,7.39-2.38,11.45-8.41-2.09-16.69-3.25-25.2-2.06,6.25,3.05,12.4,6.47,18.99,8.2,12.51,3.27,25.47,4.11,38.36,5.04.76.05,1.54-.15,2.27-.23v-4.85c-5.63.87-10.94,1.68-16.58,2.55-.73-3.98-1.4-7.7-2.09-11.42-.92-4.89-.78-9.65.68-14.49.83-2.76.99-5.81.94-8.72-.13-8.26,1.22-16.23,4.02-23.98.34-.95.57-1.94,1-3.44-1.09.55-1.67.84-2.24,1.13,2.86-3.12,2.26-6.95,2.11-10.66-.02-.4-.92-.77-1.41-1.16,1.77-1.95,1.75-4.46,2.19-6.84.57-3.07,1.27-6.11,1.7-9.2.24-1.73,1.69-3.16.55-5.36-.64-1.24.57-3.39.82-5.15.68-4.69,1.31-9.39,1.93-14.09.16-1.24.22-2.49.36-4.07h8.09c.16-3.3.31-6.34.47-9.56,3.24-.82,6.14-2.26,8.41,1.9.64,1.17,3.37,1.2,6.12,2.05-2.79.89-4.85,2.03-6.94,2.07-2,.04-4.03-1.05-6.4-1.76v5.11h8.34c-3.06,5.11-.79,20.56,2.82,23.07-.59,1.04-1.54,1.99-1.61,3-.68,9.08.99,17.88,3.54,26.53.34,1.14,1.85,1.93,2.91,2.98-2.38-.26-3.11,1.1-3.21,3.37-.43,9.7,1.88,18.88,5.13,27.88.32.87,1.33,1.5,2.05,2.27-2.74,1.68-2.83,4.61-3.07,7.38-.5,5.9.75,11.64,1.98,17.36.34,1.57.71,3.13,1.19,5.22-5.97-2.67-11.53-5.51-18.2-4.25v5.66c13.6.9,26.99.6,40.51.8.17-1.23.33-2.01.37-2.8.05-1.2.01-2.4.01-4.29-5.71.93-10.99,1.79-16.69,2.71-2.19-8.68-4.07-17.43-2.07-26.38.42-1.88.07-3.91,1.23-5.9.91-1.57-.05-4.18-.04-6.33.06-9.73,1.66-19.21,5.08-28.45-.64-.5-1.21-.94-1.81-1.41,2-1.48,1.99-1.48,1.87-3.8-.46-8.89.58-17.63,2.6-26.29.33-1.42,2.05-3.03.05-4.82-.42-.38,1.01-2.45.99-3.73-.09-6.16.68-12.19,2.17-18.16.27-1.09.04-2.3.04-3.77h8.29v-8.48c3.56-1.2,6.84-1.44,10.2-.62.52.13,1.35.19,1.48.5,1.48,3.67,4.81,2.71,7.58,3.12.6.09,1.2.09,1.84.45-3.89,1.47-7.81,2.68-12.01,2.57-.52-.01-1.31-.07-1.51-.39-1.61-2.63-3.78-1.1-5.93-1.07v3.94h7.92c-.45,1.78-1.31,3.38-1.17,4.89.5,5.53,1.22,11.05,2.12,16.53.25,1.51,1.39,2.87,2.16,4.37-1.91.53-1.76,2.52-1.8,4.34-.2,7.8,1.05,15.44,2.62,23.05.22,1.07.42,2.14.74,3.18.58,1.86.58,4.31,4.41,3.28-.23.37-.45.74-.68,1.11-.91.27-1.83.55-2.74.82-2.43,9.16,1.84,32.84,5.98,35.67-.81,2.01-1.84,3.81-2.27,5.74-1.53,6.96.09,13.78,1.25,20.61.38,2.24.86,4.46,1.38,7.15-5.89-3.12-11.33-5.88-17.99-4.68v7.43c2.61,0,5.14,0,7.67,0,2.04,0,4.12-.22,6.11.1,5.05.83,8.71-.44,10.25-5.76.5-1.72,1.86-2.13,3.53-2.04,1.74.09,3.49.02,5.52.02,1.85-11.41,1.76-22.49,1.88-33.95h-7.91c0-16.5,3.36-32.33,4.21-48.54,1.46-.12,2.78-.22,4.44-.35.2-2.94.38-5.74.58-8.78,3.44-1.27,6.93-.89,10.41-.54.26.03.66.12.73.29,1.79,4.58,6.19,2.58,9.91,3.94-4.41,1.59-8.49,2.76-12.66,2.14-2.18-.33-4.05-2.51-7.06-1.02-.07.94-.16,2.22-.28,3.88h6.24c-1.14,7.04-.5,13.54,1.88,19.87.11.3.54.62.47.82-3.1,9.27.47,18,1.7,27.61,6.9-2.97,13.18-5.68,19.47-8.39-2.8,4.13-.12,7.86.85,11.41,1.73,6.41,4.15,12.65,6.46,18.89.39,1.06,1.7,1.79,2.92,3-4.32.79-8.55,1.58-12.79,2.33-7.73,1.38-15.46,2.76-23.2,4.09-1.49.26-2.29.79-1.65,2.7,9.79.39,19.51-1,29.66-2.88-.48,2.7-.87,4.89-1.26,7.07.75.35,1.33.63,2.41,1.13-.9,1.67-1.38,3.85-2.71,4.7-2.15,1.38-2.12,2.44-1.14,4.47.96,1.99-.27,3.76-1.66,5.23-.64.67-1.7,1.09-2.06,1.86-1.94,4.18-5.38,4.42-9.43,4.41-41.65-.11-83.3-.09-124.96-.03-2.91,0-4.84-.7-6.87-3.08-7.29-8.53-15.69-15.77-25.88-20.82-12.66-6.28-25.19-12.81-37.77-19.24-1.16-.59-2.27-1.28-3.85-2.17,2.77-.21,4.88-.37,6.99-.54-.28.45-.56.91-1.08,1.73,8.92,3.85,17.76,7.66,26.55,11.45,2.29-2.5,4.26-4.65,6.45-7.04-9.94-6.62-20.5-7.61-31.5-6.47Zm63.49,32.09c.25,3.06,1.85,3.31,3.79,3.4,10.19.43,20.38,1.26,30.57,1.34,28.98.22,57.96.15,86.94.18,1.2,0,2.4-.18,3.84-.3v-3.99c-41.77,1.7-83.35,1.34-125.15-.62Zm127.98,6.31c-42.06,1.69-83.66,1.32-125.31-.57.17,2.98,1.7,3.32,3.69,3.39,8.01.27,16.02.61,24.03.98,30.97,1.44,61.94.94,92.92.54,1.45-.02,2.89-.23,4.39-.36.09-1.34.16-2.27.28-3.98Zm-11.45-23.69c-.06-7.28.03-14.72-1.4-22.25-.88.73-1.62,1.58-1.61,2.42.05,6.11.25,12.21.43,18.32.04,1.24.46,2.16,2.59,1.51Zm28.99-4.09c-.03-.31-.07-.62-.1-.94-8.21-1.69-15.82.13-23.02,4.33,7.71-1.13,15.41-2.26,23.12-3.39Zm-70.67-22.08c-.32.43-.65.85-.97,1.28.57.79,1.12,2.22,1.72,2.25,4.3.2,8.62.1,12.94.1.03-.42.06-.84.08-1.26-4.59-.79-9.18-1.58-13.77-2.38Zm-17.89,2.64c.04.33.09.67.13,1,3.62,0,7.24,0,10.85,0,2.32,0,2.17-1.26,1.53-3.25-4.27.77-8.4,1.5-12.52,2.24Zm-14.88,4.23c-3.76-2.11-7.75-2.44-11.78-2.59-1.79-.07-2.47.61-1.79,2.59h13.56Zm-3.23-33.72c-3.5-2.32-6.74-2.5-9.88-2.66-1.78-.09-1.62,1.29-1.01,2.66h10.89Zm-14.55,32.37c-.25-.44-.51-.87-.76-1.31-4.17.65-8.34,1.31-12.51,1.96.02.28.04.57.06.85,3.84,0,7.69.06,11.52-.07.58-.02,1.13-.94,1.69-1.44Zm59.57-39.38c-2.39-2.13-5.26-2.54-8.2-2.64-2-.07-2.14.99-1.52,2.64h9.72Zm-68.86,6.16c.08.31.17.63.25.94,2.53,0,5.07.1,7.6-.03,1.74-.09,1.96-1.07.87-2.65-2.91.58-5.82,1.16-8.73,1.74Zm55.37-6.21c.61-2.66-.87-2.54-2.29-2.34-1.21.17-2.41.46-3.59.76-1.15.3-2.27.69-3.41,1.04.07.18.13.36.2.54h9.09Z"/></svg>"""
        , unsafe_allow_html=True)
    name, authentication_status, username = authenticator.login('Login', 'sidebar')

    if authentication_status:
        with st.sidebar:
            st.text("Welcome " + username )
            authenticator.logout('Logout', 'main')
    elif authentication_status is False:
        with st.sidebar:
            st.info("Please Login")
            st.error('Username/password is incorrect')
    elif authentication_status is None:
            st.markdown(
                """
            <style>
                [data-testid="stSidebarNav"] {
                    display: none
                }
            </style>
            """,
                unsafe_allow_html=True,
            )
            with st.sidebar:
                st.info("Please Login")
    return name, authentication_status, username







